<Window x:Class="MusicLibrary.Views.EditDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:MusicLibrary.ViewModels"
        xmlns:model="clr-namespace:MusicLibrary"
        Title="{Binding DialogTitle}"
        SizeToContent="WidthAndHeight"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize">

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- TOP: selector + name + (track length) -->
        <StackPanel Grid.Row="0" Width="420">

            <!-- Selector (om man öppnar från menyn utan context) -->
            <StackPanel Margin="0,0,0,10"
                Visibility="{Binding ShowSelector, Converter={StaticResource BoolToVisibilityConverter}}">
                <TextBlock Text="{Binding SelectorLabel}" Margin="0,0,0,4"/>

                <ListBox ItemsSource="{Binding SelectorItems}"
                 SelectedItem="{Binding SelectedSelectorItem}"
                 Height="180">
                    <ListBox.Resources>
                        <DataTemplate DataType="{x:Type model:Artist}">
                            <TextBlock Text="{Binding Name}"/>
                        </DataTemplate>

                        <DataTemplate DataType="{x:Type model:Album}">
                            <TextBlock>
                        <Run Text="{Binding Title}"/>
                        <Run Text=" — "/>
                        <Run Text="{Binding Artist.Name}"/>
                            </TextBlock>
                        </DataTemplate>

                        <DataTemplate DataType="{x:Type model:Track}">
                            <TextBlock>
                        <Run Text="{Binding Name}"/>
                        <Run Text=" — "/>
                        <Run Text="{Binding Album.Title}"/>
                            </TextBlock>
                        </DataTemplate>
                    </ListBox.Resources>
                </ListBox>
            </StackPanel>

            <!-- Name -->
            <StackPanel Margin="0,0,0,10"
                Visibility="{Binding ShowName, Converter={StaticResource BoolToVisibilityConverter}}">
                <TextBlock Text="{Binding NameLabel}" Margin="0,0,0,4"/>
                <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"/>
            </StackPanel>

            <!-- Artist selector (only when adding an album from menu, i.e. no context) -->
            <StackPanel Margin="0,0,0,10"
            Visibility="{Binding ShowArtistSelectorForAlbum, Converter={StaticResource BoolToVisibilityConverter}}">
                <TextBlock Text="Artist" Margin="0,0,0,4"/>
                <ComboBox ItemsSource="{Binding Artists}"
              SelectedItem="{Binding SelectedArtistForAlbum}"
              DisplayMemberPath="Name"/>
            </StackPanel>

            <!-- Album selector (only when adding a track from menu, i.e. no context) -->
            <StackPanel Margin="0,0,0,10"
            Visibility="{Binding ShowAlbumSelectorForTrack, Converter={StaticResource BoolToVisibilityConverter}}">
                <TextBlock Text="Album (optional)" Margin="0,0,0,4"/>
                <ComboBox ItemsSource="{Binding Albums}"
              SelectedItem="{Binding SelectedAlbum}"
              DisplayMemberPath="Title"/>
            </StackPanel>

            <!-- Track length only -->
            <StackPanel Margin="0,0,0,10"
                Visibility="{Binding ShowTrackLength, Converter={StaticResource BoolToVisibilityConverter}}">
                <TextBlock Text="Length min/sec (mm:ss)" Margin="0,0,0,4"/>
                <TextBox Text="{Binding MillisecondsText, UpdateSourceTrigger=PropertyChanged}"/>
            </StackPanel>

            <TextBlock Text="{Binding ErrorText}"
               Foreground="DarkRed"
               TextWrapping="Wrap"
               Margin="0,4,0,0"/>
        </StackPanel>

        

        <!-- Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
            <Button Content="Cancel" Width="90" Margin="0,0,8,0" IsCancel="True"/>
            <Button Content="{Binding ConfirmLabel}" Width="90"
                    Command="{Binding ConfirmCommand}"
                    IsDefault="True"/>
        </StackPanel>
    </Grid>
</Window>
