<Window x:Class="MusicLibrary.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:model="clr-namespace:MusicLibrary"
        mc:Ignorable="d"
        Title="PALT FACTORY" Height="500" Width="1000">


    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="400" />
                <ColumnDefinition Width="2*" />
            </Grid.ColumnDefinitions>

            <!-- LEFT PLAYLIST-->

            <Border Grid.Column="0"
                    BorderBrush="LightGray"
                    BorderThickness="1"
                    Margin="5">

                <DockPanel>
                    <Grid DockPanel.Dock="Top" Margin="5,5,5,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0"
                                   Text="Playlists"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"/>

                        <StackPanel Grid.Column="1"
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center">

                            <Button Style="{StaticResource HeaderIconButton}"
                                    Command="{Binding AddPlaylistDialogCommand}"
                                    ToolTip="Add playlist">
                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE710;"/>
                            </Button>


                        </StackPanel>
                    </Grid>


                    <ListBox ItemsSource="{Binding Playlists}"
                             SelectedItem="{Binding SelectedPlaylist, Mode=TwoWay}"
                             DisplayMemberPath="Name"
                             Margin="5">

                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <EventSetter Event="PreviewMouseRightButtonDown"
                                             Handler="PlaylistItem_PreviewMouseRightButtonDown"/>

                                <Setter Property="Tag"
                                        Value="{Binding DataContext, RelativeSource={RelativeSource AncestorType=ListBox}}"/>

                                <Setter Property="ContextMenu">
                                    <Setter.Value>
                                        <!-- DataContext = ViewModel -->
                                        <ContextMenu DataContext="{Binding PlacementTarget.Tag, RelativeSource={RelativeSource Self}}">

                                            <MenuItem Header="Edit"
                                                      Command="{Binding UpdatePlaylistDialogCommand}"
                                                      CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                                                <MenuItem.Icon>
                                                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE70F;"/>
                                                </MenuItem.Icon>
                                            </MenuItem>

                                            <MenuItem Header="Delete"
                                                      Command="{Binding DeleteSelectedPlaylistCommand}">
                                                <MenuItem.Icon>
                                                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE74D;"/>
                                                </MenuItem.Icon>
                                            </MenuItem>

                                        </ContextMenu>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </ListBox.ItemContainerStyle>

                    </ListBox>
                </DockPanel>

            </Border>


            <!-- MIDDLE: ARTISTS -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Border BorderBrush="LightGray"
                        BorderThickness="1"
                        Margin="5">
                    <DockPanel>
                        <Grid Margin="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <!-- Header -->
                                <RowDefinition Height="Auto"/>
                                <!-- Search -->
                                <RowDefinition Height="*"/>
                                <!-- Tree -->
                            </Grid.RowDefinitions>

                            <!-- Header -->
                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0"
                                           Text="Artists"
                                           FontWeight="Bold"
                                           VerticalAlignment="Center"/>

                                <!-- Add artist -->
                                <Button Grid.Column="1"
                                        Style="{StaticResource HeaderIconButton}"
                                        Margin="0,0,6,0"
                                        Command="{Binding AddArtistDialogCommand}"
                                        ToolTip="Add artist">
                                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE710;"/>
                                </Button>

                                <!-- Info icon -->
                                <Button Grid.Column="2"
                                        Style="{StaticResource HeaderIconButton}"
                                        ToolTipService.ShowDuration="60000"
                                        Click="InfoButton_Click"
                                        AutomationProperties.Name="Information"
                                        AutomationProperties.HelpText="Click the plus icon next to playlist header to add playlist. Click the plus icon next to artist header to add artist. Search artist/album/track. Press Enter or click Search. Right click artist/album/track to access context menu for editing.">

                                    <Button.ToolTip>
                                        <ToolTip Placement="Mouse">
                                            <TextBlock TextWrapping="Wrap">
                                                <Run Text="Click the plus icon next to playlist header to add playlist" />
                                                <LineBreak/>
                                                <Run Text="Click the plus icon next to artist header to add artist" />
                                                <LineBreak/>
                                                <Run Text="Search artist/album/track. Press Enter or click Search."/>
                                                <LineBreak/>
                                                <Run Text="Right click artist/album/track to access menu for editing."/>
                                            </TextBlock>
                                        </ToolTip>
                                    </Button.ToolTip>

                                    <TextBlock Text="ⓘ"
                                               FontSize="18"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Center"/>
                                </Button>

                            </Grid>

                            <!-- Search row -->
                            <StackPanel Grid.Row="1"
                                        Orientation="Horizontal"
                                        Margin="0,8,0,8">
                                <TextBox x:Name="ArtistsSearchTextBox"
                                         Width="170"
                                         Text="{Binding ArtistTreeSearchText, UpdateSourceTrigger=PropertyChanged}"
                                         KeyDown="ArtistsSearchTextBox_KeyDown"
                                         ToolTip="Search artist, album or track"/>

                                <Button Content="Search"
                                        Margin="6,0,0,0"
                                        Click="ArtistsSearchButton_Click"/>

                                <Button Content="Clear"
                                        Margin="6,0,0,0"
                                        Click="ArtistsClearSearchButton_Click"/>
                            </StackPanel>

                            <!-- Tree -->
                            <TreeView x:Name="myTreeView"
                                      Grid.Row="2"
                                      Tag="{Binding}"
                                      SelectedItemChanged="TreeView_SelectedItemChanged"
                                      MouseDoubleClick="TreeView_MouseDoubleClick">

                                <TreeView.ItemContainerStyle>
                                    <Style TargetType="TreeViewItem">
                                        <EventSetter Event="PreviewMouseRightButtonDown"
                                                     Handler="TreeViewItem_PreviewMouseRightButtonDown"/>
                                    </Style>
                                </TreeView.ItemContainerStyle>


                                <TreeView.Resources>

                                    <HierarchicalDataTemplate DataType="{x:Type model:Artist}" ItemsSource="{Binding Albums}">
                                        <TextBlock Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType={x:Type TreeView}}}">

                                            <TextBlock.ContextMenu>
                                                <ContextMenu DataContext="{Binding PlacementTarget.Tag, RelativeSource={RelativeSource Self}}">
                                                    <MenuItem Header="Add album"
                                                              Command="{Binding AddAlbumUnderArtistCommand}"
                                                              CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}"
>
                                                        <MenuItem.Icon>
                                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE710;"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                    <Separator/>
                                                    <MenuItem Header="Edit artist"
                                                              Command="{Binding EditArtistFromNodeCommand}"
                                                              CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}"
>
                                                        <MenuItem.Icon>
                                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE70F;"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                    <MenuItem Header="Delete artist"
                                                              Command="{Binding DeleteArtistFromNodeCommand}"
                                                              CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}"
>
                                                        <MenuItem.Icon>
                                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE74D;"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                </ContextMenu>
                                            </TextBlock.ContextMenu>


                                            <Run Text="{Binding Name}" />
                                            <Run Text=" (" />
                                            <Run Text="{Binding Albums.Count, Mode=OneWay}" />
                                            <Run Text=" albums)" />
                                        </TextBlock>
                                    </HierarchicalDataTemplate>

                                    <HierarchicalDataTemplate DataType="{x:Type model:Album}" ItemsSource="{Binding Tracks}">
                                        <TextBlock Text="{Binding Title}" Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType={x:Type TreeView}}}">

                                            <TextBlock.ContextMenu>
                                                <ContextMenu DataContext="{Binding PlacementTarget.Tag, RelativeSource={RelativeSource Self}}">
                                                    <MenuItem Header="Add track"
                                                              Command="{Binding AddTrackUnderAlbumCommand}"
                                                              CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}"
>
                                                        <MenuItem.Icon>
                                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE710;"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>

                                                    <Separator/>

                                                    <MenuItem Header="Edit album"
                                                              Command="{Binding EditAlbumFromNodeCommand}"
                                                              CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}"
>
                                                        <MenuItem.Icon>
                                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE70F;"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>

                                                    <MenuItem Header="Delete album"
                                                              Command="{Binding DeleteAlbumFromNodeCommand}"
                                                              CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}"
>
                                                        <MenuItem.Icon>
                                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE74D;"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                </ContextMenu>

                                            </TextBlock.ContextMenu>
                                         </TextBlock>
                                    </HierarchicalDataTemplate>

                                    <HierarchicalDataTemplate DataType="{x:Type model:Track}">
                                        <TextBlock Text="{Binding Name}" Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType={x:Type TreeView}}}">

                                            <TextBlock.ContextMenu>
                                                <ContextMenu DataContext="{Binding PlacementTarget.Tag, RelativeSource={RelativeSource Self}}">
                                                    <MenuItem Header="Add track to selected playlist"
                                                              Command="{Binding AddTrackToSelectedPlaylistFromNodeCommand}"
                                                              CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}"
>
                                                        <MenuItem.Icon>
                                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE710;"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>

                                                    <Separator/>

                                                    <MenuItem Header="Edit track"
                                                              Command="{Binding EditTrackFromNodeCommand}"
                                                              CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}"
>
                                                        <MenuItem.Icon>
                                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE70F;"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>

                                                    <MenuItem Header="Delete track"
                                                              Command="{Binding DeleteTrackFromNodeCommand}"
                                                              CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}"
>
                                                        <MenuItem.Icon>
                                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE74D;"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                </ContextMenu>

                                            </TextBlock.ContextMenu>
                                    </TextBlock>
                                    </HierarchicalDataTemplate>

                                </TreeView.Resources>
                            </TreeView>

                        </Grid>
                    </DockPanel>

                </Border>
            </Grid>

            <!-- RIGHT Tracks in playlist-->
            <Border Grid.Column="2"
                    BorderBrush="LightGray"
                    BorderThickness="1"
                    Margin="5">

                <DockPanel>
                    <TextBlock Text="Tracks in playlist"
                               FontWeight="Bold"
                               Padding="5"
                               DockPanel.Dock="Top"/>

                    <DataGrid x:Name="myDataGrid"
                              Margin="5"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              CanUserResizeColumns="False"
                              CanUserResizeRows="False"
                              CanUserReorderColumns="False"
                              CanUserSortColumns="True"
                              SelectionMode="Extended"
                              SelectionUnit="CellOrRowHeader"
                              RowHeaderWidth="28"
                              HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Auto"
                              AlternationCount="2"
                              ItemsSource="{Binding Tracks}"
                              ScrollViewer.ScrollChanged="DataGrid_ScrollChanged"
                              IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                              SelectedItem="{Binding SelectedPlaylistTrack, Mode=TwoWay}">

                        <DataGrid.RowHeaderStyle>
                            <Style TargetType="DataGridRowHeader">
                                <Setter Property="Content" Value="🗑"/>
                                <Setter Property="ToolTip" Value="Ta bort låt från playlist"/>
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                <Setter Property="Cursor" Value="Hand"/>
                                <Setter Property="Foreground" Value="#686868"/>
                                <Setter Property="Padding" Value="5"/>
                                <EventSetter Event="PreviewMouseLeftButtonDown"
                                             Handler="RowHeader_DeleteClicked"/>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Foreground" Value="DarkRed" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowHeaderStyle>

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Track" Binding="{Binding Name}" FontStyle="Italic" Width="*"/>
                            <DataGridTextColumn Header="Album" Binding="{Binding Album.Title}" Width="*"/>
                            <DataGridTextColumn Header="Length"
                                                Binding="{Binding Milliseconds, Converter={StaticResource MillisecondsToMmSsConverter}}"
                                                Width="Auto"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>

            </Border>

        </Grid>
    </Grid>
</Window>
